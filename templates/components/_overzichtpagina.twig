{% do craft.app.view.registerCssFile('@web/css/overzichtstyles.css') %}

{% set filterQuery = craft.app.request.getParam('filter') %}

{% set relationParam = ['and'] %}

{% if filterQuery %}
    {% for filterId in filterQuery %}
        {% set relationParam = relationParam|merge([{ targetElement: filterId }]) %}
    {% endfor %}
{% endif %}

{% set entries = craft.entries.section('product') %}

{% if relationParam|length > 1 %}
    {% set entries = entries.relatedTo(relationParam) %}
{% endif %}

{% paginate entries.limit(6) as pageInfo, pageEntries %}

<body>
<section>
    <div class="introductie">
        <h1 class="titeloverzicht">{{ allProducts.introtitle }}</h1>
        <p class="omschrijvingoverzicht">{{ allProducts.descriptionintrotitle }}</p>
    </div>
    <form method="get">
        <div class="filters">
            {% for filter in craft.entries.section('filter') %}
                <input type="checkbox" id="{{ filter.id }}" value="{{ filter.id }}" name="filter[]" {% if filterQuery and filter.id in filterQuery %} checked {% endif %} class="filter-checkbox">
                <label for="{{ filter.id }}" class="filter-label">{{ filter.title }}</label>
            {% endfor %}
            <button class="button" type="submit">Filter</button>
        </div>
    </form>

    <div class="wrapper">
        {% for product in pageEntries %}
            {% set image = product.productimage.one() %}
            <div class="single-card">
                <div class="img-area">
                    <img src="{{ image.url }}" alt="{{ product.title }}">
                    <div class="overlay">
                        <button class="view-details">View details</button>
                    </div>
                </div>
                <div class="info">
                    <h3>{{ product.title }}</h3>
                    <p class="price">${{ product.productpricetag }}</p>
                    {% set words = product.productdescription|split(' ') %}
                    {% set truncatedDescription = words|length > 10 ? words|slice(0, 10)|join(' ') ~ '...' : product.productdescription %}
                    <p class="description">{{ truncatedDescription }}</p>
                </div>
            </div>
        {% endfor %}
    </div>
    <div class="pagination">
        {% for i in 1..pageInfo.totalPages %}
            <button onclick="location.href='{{ pageInfo.getPageUrl(i) }}'" class="button{% if pageInfo.currentPage == i %} active{% endif %}">
                {{ i }}
            </button>
        {% endfor %}
    </div>
</section>
</body>
